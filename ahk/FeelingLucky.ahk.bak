
#Include 3rdParty\FileContainer\FC.ahk
#include 3rdParty\FileContainer\Container.ahk
#include 3rdParty\FileContainer\Prefs.ahk
#include 3rdParty\FileContainer\ShellFileOperation.ahk

#include 3rdParty\URLfetch.ahk

#include ..\..\Google Drive\TEK\SettingsConfig\ahk\ahk_personal_info.ahk
#NoEnv
EnvGet, USERPROFILE, USERPROFILE
EnvGet, TEMP, TEMP
RAlt:: ; When keyboard layout is US
ImFeelingLucky()
Return
LCtrl & RAlt:: ; When keyboard layout is Norwegian. "Altgr "
ImFeelingLucky()
Return

ImFeelingLucky(){
	DefaultBrowser = chrome.exe
	;Search := Clip() ; Capture selected text
	Clipboard:=
	Send, ^c	
	Search:=Clipboard
	Search := RegExReplace(Search, "^\s*([\s\S]*?)\s*$", "$1") ; Trim spaces
	If WinActive("ahk_exe explorer.exe"){
		selection := FC("explorer","","selection")
		numFiles:=selection.len()	
		
		If (numFiles==""){ ; If no files are selected, open cmd in open folder
			Run, %ComSpec%, % FC("explorer","","folder")[1]
		}
		Else If (numFiles==1){
			filepath:=selection[1]
			SplitPath, filepath, name, dir, ext, name_no_ext, drive
			If (ext=="pst"){
				Run "C:\Program Files\Schlumberger\PIPESIM2020.1\Programs\psimstub.exe" -X %filepath%
			}
			Else If (ext=="tnt"){
				Run "C:\Program Files\Schlumberger\PIPESIM2020.1\Programs\pnettub.exe" -X %filepath%
			}
			

			Clipboard:=selection[1] ; When one file is selected, copy path to clipboard.
		}
		Else If (numFiles>1){
			msgbox greater than 1
			msgbox %paths%
			
		}
	}
	Else If (Search == ""){
		If WinActive("ahk_exe chrome.exe")or  WinActive("ahk_exe firefox.exe"){
			WinGetClass, strClass, A
			url:=GetCurrentUrlAcc(strClass)
			If (RegExMatch(url, "idporten\.difi\.no") or RegExMatch(url, "secure\.edb\.com") or RegExMatch(url, "signicat") or RegExMatch(url, "eid\.bluestep") or RegExMatch(url, "\investor\.nordea\.no") or RegExMatch(url, "nettbanken\.nordea\.no")){
				phone_fnum()	; See ahk_personal_info.ahk
			}
			Else If (RegExMatch(url, "identity\.banknorwegian\.no")){
				pnum_phone()	; See ahk_personal_info.ahk
			}
			Else If (RegExMatch(url, "sauth\.cfs\.slb\.com")){
				send {tab}
				send {tab}
				work_email()	; See ahk_personal_info.ahk
				send {enter}
			}
			Else {
				Clipboard:=url ; Copy URL to clipboard
			}
		}
		Else If WinActive("ahk_exe Slb.Production.Engineering.Desktop.exe"){
			WinGetTitle, Title, A
			WinKill, %Title%
		}
		Else
			Run % DefaultBrowser A_Space "https://intouchsupport.com/index.cfm?event=ite.workspace"
		}
	Else If (Search <> "")
		If RegExMatch(Search, "i)^HKEY_|HKCR|HKCU|HKLM|HKU|HKU|HKCC") {	; If it's a registry key, open RegEdit to that key.
			Process, Close, regedit.exe
			RegWrite, REG_SZ, HKEY_CURRENT_USER, Software\Microsoft\Windows\CurrentVersion\Applets\Regedit, Lastkey, %Search% ; This key determines where regedit.exe opens
			Run regedit.exe, , Max
		}
		Else If RegExMatch(Search, "^\d+\.\d+\.\d+\.\d+$") ; If IP address
		Run %DefaultBrowser% http://whatismyipaddress.com/ip/%Search%
		Else If (InStr(Search, ":\") = 2) or (InStr(Search, "\\") = 1) or (InStr(Search, "%") = 1) { ; If it appears to be a filepath, run it
			Transform, Search, Deref, %Search%
			Run %Search%
		}
		else  If (RegExMatch(Search, "^\d+$"))  { ; Detect integers
			If (Search>5000000)
				Run % DefaultBrowser A_Space "https://intouchsupport.com/index.cfm?event=ITE.edit&contentid="Search
			Else If (Search>5000)
				Run % DefaultBrowser A_Space "https://dev.azure.com/slb-swt/Flow_Assurance/_workitems/edit/"Search	
			;Run % DefaultBrowser A_Space "https://www.customercarecenter.slb.com/saw/Request/"Search
		}
		else  If (InStr(Search, "http") = 1) or RegExMatch(Search, "^[\w-]+\.[\w-]+(\.[\w-]+) {0,3}(/.*)?$") ; If it appears to be a URL then run it with the default browser (sometimes I change mine)
		Run % DefaultBrowser A_Space Search
		Else
			Run % DefaultBrowser A_Space "http://www.google.com/search?q=" EncodeURL(Search) "&btnI=1"
Return
}
;=============================================[Std.ahk]=============================================


Clip(Text="", Reselect="") ; http://www.autohotkey.com/forum/viewtopic.php?p=467710 , modified August 2012
{
	Static BackUpClip, Stored, LastClip
	If (A_ThisLabel = A_ThisFunc) {
		If (Clipboard == LastClip)
			Clipboard := BackUpClip
		BackUpClip := LastClip := Stored := ""
	}else  {
		If !Stored {
			Stored := True
			BackUpClip := ClipboardAll
		} Else
			SetTimer, %A_ThisFunc%, Off
		LongCopy := A_TickCount, Clipboard := "", LongCopy -= A_TickCount
		If (Text = "") {
			Send, ^c
			ClipWait, LongCopy ? 0.5 : 0.25
		}else  {
			Clipboard := LastClip := Text
			ClipWait, 10
			Send, ^v
		}
		SetTimer, %A_ThisFunc%, -700
		If (Text = "")
			Return LastClip := Clipboard
		Else If (ReSelect = True) or (Reselect and (StrLen(Text) < 3000)) {
			Sleep 30
			StringReplace, Text, Text, `r, , All
			SendInput, % "{Shift Down}{Left " StrLen(Text) "}{Shift Up}"
		}
	}
	Return
	Clip:
Return Clip()
}

EncodeURL(Text, FromURL=False) ; Uberi
{
	FormatInteger := A_FormatInteger, FoundPos := 0, SearchFor := FromURL ? "%.." : "[^\w-.~% ]"
	SetFormat, IntegerFast, Hex
	If !FromURL
	StringReplace, Text, Text, `%, `%25, All
	While (FoundPos := RegExMatch(Text, SearchFor, Char, FoundPos + 1))
	StringReplace, Text, Text, %Char%, % FromURL ? Chr("0x" SubStr(Char, 2)) : "%" SubStr(0 SubStr(Asc(Char), 3), -1), All
	If !FromURL {
		StringReplace, Text, Text, %A_Space%, +, All
		Text := RegExReplace(Text, "%..", "$U0") ; Only necessary on berban's computer so comment this line out.
	}
	SetFormat, IntegerFast, %FormatInteger%
	Return Text
}


Explorer_GetPath(hwnd="")
{
	if !(window := Explorer_GetWindow(hwnd))
	return ErrorLevel := "ERROR"
	if (window="desktop")
		return A_Desktop
	path := window.LocationURL
	path := RegExReplace(path, "ftp://.*@","ftp://")
	StringReplace, path, path, file:///
	StringReplace, path, path, /, \, All 
	Loop
	If RegExMatch(path, "i)(?<=%)[\da-f]{1,2}", hex)
	StringReplace, path, path, `%%hex%, % Chr("0x" . hex), All
	Else Break
	return path
}
Explorer_GetAll(hwnd="")
{
	return Explorer_Get(hwnd)
}
Explorer_GetSelected(hwnd="")
{
	return Explorer_Get(hwnd,true)
}
Explorer_GetWindow(hwnd="")
{
	WinGet, process, processName, % "ahk_id" hwnd := hwnd? hwnd:WinExist("A")
	WinGetClass class, ahk_id %hwnd%
	if (process!="explorer.exe")
		return
	if (class ~= "(Cabinet|Explore)WClass")
	{
		for window in ComObjCreate("Shell.Application").Windows
		if (window.hwnd==hwnd)
			return window
	}
	else if (class ~= "Progman|WorkerW") 
		return "desktop"
}
Explorer_Get(hwnd="",selection=false)
{
	if !(window := Explorer_GetWindow(hwnd))
	return ErrorLevel := "ERROR"
	if (window="desktop")
	{
		ControlGet, hwWindow, HWND,, SysListView321, ahk_class Progman
		if !hwWindow
		ControlGet, hwWindow, HWND,, SysListView321, A
		ControlGet, files, List, % ( selection ? "Selected":"") "Col1",,ahk_id %hwWindow%
		base := SubStr(A_Desktop,0,1)=="\" ? SubStr(A_Desktop,1,-1) : A_Desktop
		Loop, Parse, files, `n, `r
		{
			path := base "\" A_LoopField
			IfExist %path%
			ret .= path "`n"
		}
	}else  {
		if selection
		collection := window.document.SelectedItems
		else
			collection := window.document.Folder.Items
		for item in collection
		ret .= item.path "`n"
	}
	return Trim(ret,"`n")
}            